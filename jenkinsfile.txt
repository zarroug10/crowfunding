pipeline {
  agent any
  
  environment {
    DOCKERHUB_CREDENTIALS = credentials('dockerhub')
  }

  stages {
    stage('Build Spring') {
      steps {
        script {
          // Change to the directory where your Spring application is located
          dir('Backend/') {
            // Build the Docker image for Spring
            sh 'docker build -t username/spring .'
          }
        }
      }
    }

    stage('Build Angular') {
      steps {
        script {
          // Change to the directory where your Angular application is located
          dir('Front-End/') {
            // Build the Docker image for Angular
            sh 'docker build -t username/angular .'
          }
        }
      }
    }

    stage('Login to DockerHub') {
      steps {
        withCredentials([usernamePassword(credentialsId: 'dockerhub', passwordVariable: 'DOCKERHUB_CREDENTIALS_PSW', usernameVariable: 'DOCKERHUB_CREDENTIALS_USR')]) {
          sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
        }
      }
    }

    stage('Push Docker Images') {
      steps {
        // Push the Docker images to DockerHub
        sh 'docker push username/spring'
        sh 'docker push username/angular'
      }
    }
  }

  post {
    always {
      node('any') {
        // Logout from DockerHub
        sh 'docker logout'
      }
    }
  }
}
